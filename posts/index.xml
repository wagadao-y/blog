<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on wagadao-y's Blog</title><link>https://wagadao-y.github.io/blog/posts/</link><description>Recent content in Posts on wagadao-y's Blog</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Sat, 13 Jan 2024 15:37:48 +0900</lastBuildDate><atom:link href="https://wagadao-y.github.io/blog/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>[AWS IoT Core] Pythonのpaho-mqttで接続してみる</title><link>https://wagadao-y.github.io/blog/posts/2024-01-13/</link><pubDate>Sat, 13 Jan 2024 15:37:48 +0900</pubDate><guid>https://wagadao-y.github.io/blog/posts/2024-01-13/</guid><description>AWS IoT CoreはIoTデバイスをAWSクラウドに接続するためのサービスです。
PythonからIoT Coreに接続するための方法として、AWS IoT Device SDK for Python が提供されていますが、今回はPCからPythonのpaho-mqttを使って接続してみます。
実行環境 OS : Windows 11 Home 23H2
Python : 3.10.11
paho-mqtt : 1.6.1
AWS側の設定 まずはAWS IoTリソースの作成に従って、AWS側を設定していきます。
AWS IoTコンソールの「デバイスの接続」から作成しても良いですが、ドキュメントに従って進めます。
ポリシーの作成 こんな感じでMyPC-Iot_Policyポリシーを作成。 ${iot:Connection.Thing.ThingName}はポリシー変数で紐づけたモノの名前として評価されるようです。
subscribeにはtopicfilterを設定しました（topic指定では動かなかった）
{ &amp;#34;Version&amp;#34;: &amp;#34;2012-10-17&amp;#34;, &amp;#34;Statement&amp;#34;: [ { &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;, &amp;#34;Action&amp;#34;: &amp;#34;iot:Connect&amp;#34;, &amp;#34;Resource&amp;#34;: &amp;#34;arn:aws:iot:ap-northeast-1:584353810655:client/${iot:Connection.Thing.ThingName}&amp;#34; }, { &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;, &amp;#34;Action&amp;#34;: [ &amp;#34;iot:Publish&amp;#34;, &amp;#34;iot:Receive&amp;#34; ], &amp;#34;Resource&amp;#34;: &amp;#34;arn:aws:iot:ap-northeast-1:584353810655:topic/${iot:Connection.Thing.ThingName}*&amp;#34; }, { &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;, &amp;#34;Action&amp;#34;: &amp;#34;iot:Subscribe&amp;#34;, &amp;#34;Resource&amp;#34;: &amp;#34;arn:aws:iot:ap-northeast-1:584353810655:topicfilter/${iot:Connection.Thing.ThingName}*&amp;#34; } ] } モノの作成 モノの名前をMyPC、証明書は「新しい証明書を自動生成する (推奨)」を選択し、MyPC-Iot_Policyポリシーにアタッチ。</description></item></channel></rss>